@echo off
rem =============================================================================
rem Council Mode: Siraj Compression (Collapse) - SYNCHRONIZED BROWSER TIMING FIX
rem Pattern Extractor: Browser timing race condition â†’ comprehensive readiness verification
rem Boundary Keeper: Preserve Enhanced Educational Codex v15.0 features completely
rem Synthesizer: Multi-stage health checks + synchronized launch + graceful fallbacks
rem Auditor: Zero-failure browser launch for judge demonstrations
rem Void-Caller: Collapse timing chaos â†’ rebirth as synchronized launch symphony
rem =============================================================================

title SIRAJ Enhanced Educational Codex - SYNCHRONIZED TIMING v15.1

echo.
echo ================================================================================
echo   ğŸ­ SIRAJ Enhanced Educational Codex v15.1 - SYNCHRONIZED BROWSER TIMING
echo   ğŸ”§ FIXED: Browser race conditions and 405 Method Not Allowed errors
echo   ğŸŒ€ Living Knowledge Universe - Zero-failure demonstration reliability
echo   ğŸ“š Kaggle Gemma 3 Hackathon - Judge-ready synchronized launch
echo ================================================================================
echo.

rem Council Assembly: Enhanced voices for synchronized startup orchestration
rem Lead Voice: Implementor (decisive browser timing fix execution)
rem Core Voices: Maintainer (stability), Performance (optimization), Security (safety)
rem Specialists: Architect (system integration), Developer (seamless UX)

cd /d "%~dp0"

rem Phase 1: COLLAPSE - Critical Issue Analysis
echo ğŸ” Phase 1: Critical Issue Resolution...
echo.
echo âŒ PREVIOUS ISSUES IDENTIFIED:
echo    â€¢ Browser opens before frontend ready
echo    â€¢ Frontend service startup timing problems  
echo    â€¢ 405 Method Not Allowed from routing conflicts
echo    â€¢ Race conditions in server initialization
echo.
echo âœ… SYNCHRONIZED TIMING SOLUTION:
echo    â€¢ Multi-stage comprehensive readiness verification
echo    â€¢ Browser opens ONLY after complete system validation
echo    â€¢ Graceful fallback handling for partial connectivity
echo    â€¢ Preserved Enhanced Educational Codex v15.0 features
echo.

python --version >nul 2>&1
if errorlevel 1 (
    echo âŒ Python not found! Please install Python 3.8+ from python.org
    pause
    exit /b 1
)

echo âœ… Python environment ready

rem Phase 2: COUNCIL - Synchronized Component Startup
echo.
echo ğŸ­ Phase 2: Council Assembly - Synchronized Enhanced Educational Codex...
echo.
echo Enhanced Features Available:
echo   ğŸ§  7 AI Archetypal Teachers with Enhanced Personalities
echo   âš¡ Real-time Council Streaming and WebSocket Support
echo   ğŸ“Š Advanced Learning Analytics Dashboard
echo   ğŸ“š Curriculum Alignment with Educational Standards  
echo   ğŸ“ˆ Student Progress Tracking and Adaptive Recommendations
echo   ğŸ“ Multi-perspective Homework Processing
echo   ğŸ›ï¸ Immersive World Anvil + Notion Interface Design
echo   ğŸ”§ NEW: Synchronized Browser Timing (v15.1 Fix)
echo.

rem Phase 3: SYNTHESIS - Launch with Synchronized Timing
echo ğŸš€ Phase 3: Synthesis - Synchronized Launch Activation...
echo.
echo SYNCHRONIZED TIMING SEQUENCE:
echo   1. FastAPI server startup
echo   2. Port availability verification
echo   3. Server response validation
echo   4. Health endpoint confirmation
echo   5. Frontend interface loading verification
echo   6. Backend connectivity check (optional)
echo   7. Ollama service readiness (optional)
echo   8. Browser portal activation (ONLY after complete verification)
echo.
echo â³ Browser will open automatically when ALL systems are verified ready...
echo.

python launcher_synchronized_timing.py

rem Phase 4: REBIRTH - Handle completion with enhanced reporting
echo.
if errorlevel 1 (
    echo âŒ Enhanced Educational Codex encountered an error
    echo ğŸ”§ Check the comprehensive readiness assessment above for details
    echo ğŸ“– Refer to ENHANCED-CODEX-README.md for troubleshooting
    echo ğŸ¯ Synchronized timing fix v15.1 diagnostic information provided
) else (
    echo âœ… Enhanced Educational Codex with synchronized timing shut down successfully
    echo ğŸ‘‹ Thank you for using the Living Knowledge Universe
    echo ğŸ­ Browser timing race conditions eliminated in v15.1
)

echo.
echo ================================================================================
echo   Ritual Audit ^& Memory: Synchronized timing session completed
echo   Council Voices: Implementor (lead), Maintainer, Performance, Security
echo   Critical Fix: Browser race condition elimination through readiness verification
echo   QWAN Assessment: Wholeness achieved through perfect timing synchronization
echo ================================================================================
echo.

pause
